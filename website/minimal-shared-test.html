<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Shared Test</title>
</head>
<body>
    <h1>Minimal Shared Element Test</h1>
    
    <!-- Basic shared element -->
    <div id="simple-shared" shared>Shared Element</div>
    
    <!-- Reference element -->
    <div id="ref-element" data-source="localhost:5173/minimal-shared-test#simple-shared">Reference</div>

    <script type="module">
        console.log('Starting minimal shared element test...');
        
        // First test discovery without initializing playhtml
        function testDiscovery() {
            console.log('üîç Testing discovery functions...');
            
            const sharedElements = [];
            document.querySelectorAll('[shared], [shared-domain], [shared-global]').forEach((el) => {
                if (!el.id) return;
                sharedElements.push({
                    elementId: el.id,
                    permissions: 'read-write',
                    scope: 'global',
                    path: window.location.pathname,
                });
            });
            
            const sharedReferences = [];
            document.querySelectorAll('[data-source]').forEach((el) => {
                const dataSource = el.getAttribute('data-source');
                if (!dataSource) return;
                
                const [domainAndPath, elementId] = dataSource.split('#');
                if (!domainAndPath || !elementId) return;
                
                const pathIndex = domainAndPath.indexOf('/');
                const domain = pathIndex === -1 ? domainAndPath : domainAndPath.substring(0, pathIndex);
                const path = pathIndex === -1 ? '/' : domainAndPath.substring(pathIndex);
                
                sharedReferences.push({ domain, path, elementId });
            });
            
            console.log('‚úÖ Discovered shared elements:', sharedElements);
            console.log('‚úÖ Discovered shared references:', sharedReferences);
            
            return { sharedElements, sharedReferences };
        }
        
        const discovery = testDiscovery();
        
        // Now try to load playhtml
        console.log('üì¶ Attempting to import playhtml...');
        
        try {
            const { playhtml } = await import('/packages/playhtml/dist/playhtml.es.js');
            console.log('‚úÖ Playhtml imported successfully:', typeof playhtml);
            
            console.log('üöÄ Attempting to initialize playhtml...');
            
            await playhtml.init({
                developmentMode: true,
                host: 'localhost:1999'
            });
            
            console.log('‚úÖ Playhtml initialized successfully');
            
        } catch (error) {
            console.error('‚ùå Error with playhtml:', error);
        }
        
        console.log('üèÅ Test completed');
    </script>
</body>
</html>