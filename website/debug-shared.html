<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Shared Elements</title>
</head>
<body>
    <h1>Debug Shared Elements</h1>
    
    <!-- Test shared element -->
    <div id="test-counter" shared can-move>
        <div>Counter: <span>0</span></div>
    </div>
    
    <!-- Test shared reference -->
    <div id="referenced-element" data-source="localhost:5173/debug-shared#test-counter" can-move>
        <div>Referenced: <span>-</span></div>
    </div>

    <script type="module">
        import { playhtml } from '/packages/playhtml/dist/playhtml.es.js';
        
        console.log('Testing shared element discovery...');
        
        // Test our discovery functions manually
        function testDiscovery() {
            const sharedElements = [];
            document.querySelectorAll('[shared], [shared-domain], [shared-global]').forEach((el) => {
                if (!el.id) return;
                sharedElements.push({
                    elementId: el.id,
                    permissions: 'read-write',
                    scope: 'global',
                    path: window.location.pathname,
                });
            });
            
            const sharedReferences = [];
            document.querySelectorAll('[data-source]').forEach((el) => {
                const dataSource = el.getAttribute('data-source');
                if (!dataSource) return;
                
                const [domainAndPath, elementId] = dataSource.split('#');
                if (!domainAndPath || !elementId) return;
                
                const pathIndex = domainAndPath.indexOf('/');
                const domain = pathIndex === -1 ? domainAndPath : domainAndPath.substring(0, pathIndex);
                const path = pathIndex === -1 ? '/' : domainAndPath.substring(pathIndex);
                
                sharedReferences.push({ domain, path, elementId });
            });
            
            console.log('Discovered shared elements:', sharedElements);
            console.log('Discovered shared references:', sharedReferences);
            
            return { sharedElements, sharedReferences };
        }
        
        const discovery = testDiscovery();
        
        try {
            await playhtml.init({
                developmentMode: true,
                host: 'localhost:1999'
            });
            console.log('✅ Playhtml initialized successfully');
        } catch (error) {
            console.error('❌ Playhtml initialization failed:', error);
        }
    </script>
</body>
</html>